
@{
    ViewBag.Title = "Index";
}
<script src="~/Scripts/jquery.min.js"></script>
<script src="~/Scripts/jquery.easyui.min.js"></script>
@*<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7/jquery.js"></script>*@
<script src="http://malsup.github.com/jquery.form.js"></script>

    <h2>Developer Page</h2>
        <h3>FileUpload</h3>

        @using (Ajax.BeginForm(null, null, new AjaxOptions() { HttpMethod = "POST" }, new { enctype = "multipart/form-data" }))
        {
            <table>
                <tr>
                    <td><input type="file" name="files" id="files" multiple /></td>
                    <td><input type="submit" name="upload" value="Upload" id="upload" /></td>
                </tr>
                
            </table>
        }
    <div class="progress progress-striped" style="width:60%">
    <div style="color:blue" class="progress-bar progress-bar-success">0%</div>
</div>

<div id="status"></div>
@Html.Partial("_FileBrowserPartial")
<script>
    (function () {
    var bar = $('.progress-bar');
    var percent = $('.progress-bar');
    var status = $('#status');
    var url = '@Url.Content("~")';
    $('form').ajaxForm({
        type: "POST",
        url: url+"uploadfile/api/fileupload",
        beforeSend: function() {
            status.empty();
            var percentVal = '0%';
            bar.width(percentVal)
            percent.html(percentVal);
        },
        uploadProgress: function(event, position, total, percentComplete) {
            var percentVal = percentComplete + '%';
            bar.width(percentVal)
            percent.html(percentVal);
        },
        //success: function() {
        //    var percentVal = '100%';
        //    bar.width(percentVal)
        //    percent.html(percentVal);
        //    $('#filestree').treegrid('reload');
        //},
        success: function (messages) {
            var percentVal = '100%';
            bar.width(percentVal)
            percent.html(percentVal);
            
            var mess = "";
            for (i = 0; i < messages.length; i++) {
                mess += messages[i] + "<br/>";

                //alert(messages[i]);
            }
            status.html("<p style='color:red '>" + mess + "</p>");
            $('#filestree').treegrid('reload');
        },
        error:function(xhr){            
                var percentVal = '0%';
                bar.width(percentVal)
                percent.html(percentVal);
                status.html("<p style='color:red '>" + xhr.responseText + "</p>");
        },
        
    }); 

    })();       
    
</script>

